<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="972px" preserveAspectRatio="none" style="width:1091px;height:972px;" version="1.1" viewBox="0 0 1091 972" width="1091px" zoomAndPan="magnify"><defs><filter height="300%" id="f1l6p3ja5fjcqm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="93" x2="93" y1="39.6094" y2="931.1016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="254" x2="254" y1="39.6094" y2="931.1016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="391.5" x2="391.5" y1="39.6094" y2="931.1016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="651" x2="651" y1="39.6094" y2="931.1016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="894" x2="894" y1="39.6094" y2="931.1016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1018.5" x2="1018.5" y1="39.6094" y2="931.1016"/><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="15" y="24.5332">SlaveReplWorkTrashDir</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="8" y="930.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="15" y="951.6348">SlaveReplWorkTrashDir</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="188" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="195" y="24.5332">SlaveReplWorkDir</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="188" y="930.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="195" y="951.6348">SlaveReplWorkDir</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="339.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="346.5" y="24.5332">SlaveIndexDir</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="339.5" y="930.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="346.5" y="951.6348">SlaveIndexDir</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="49" x="625" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="632" y="24.5332">Slave</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="49" x="625" y="930.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="632" y="951.6348">Slave</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="57" x="864" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="871" y="24.5332">Master</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="57" x="864" y="930.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="871" y="951.6348">Master</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="962.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="969.5" y="24.5332">MasterIndexDir</text><rect fill="#FEFECE" filter="url(#f1l6p3ja5fjcqm)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="962.5" y="930.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="969.5" y="951.6348">MasterIndexDir</text><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1076.5" x="3" y="70.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="70.7852" y2="70.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="73.7852" y2="73.7852"/><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="217" x="432.75" y="59.6094"/><line style="stroke: #000000; stroke-width: 1.0;" x1="438.75" x2="438.75" y1="71.7852" y2="71.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="438.75" x2="438.75" y1="73.7852" y2="73.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="442.75" y="76.6045">starting the replication process</text><line style="stroke: #000000; stroke-width: 1.0;" x1="641.75" x2="641.75" y1="71.7852" y2="71.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="641.75" x2="641.75" y1="73.7852" y2="73.7852"/><polygon fill="#A80036" points="882.5,111.9609,892.5,115.9609,882.5,119.9609,886.5,115.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651.5" x2="888.5" y1="115.9609" y2="115.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="658.5" y="111.4561">replication session request</text><polygon fill="#A80036" points="905.5,142.3125,895.5,146.3125,905.5,150.3125,901.5,146.3125" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1006.5,142.3125,1016.5,146.3125,1006.5,150.3125,1010.5,146.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="899.5" x2="1012.5" y1="146.3125" y2="146.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="911.5" y="141.8076">takes a snapshot</text><polygon fill="#A80036" points="662.5,172.6641,652.5,176.6641,662.5,180.6641,658.5,176.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="656.5" x2="893.5" y1="176.6641" y2="176.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="668.5" y="172.1592">returns the file list and the index UUID</text><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1076.5" x="3" y="206.1914"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="206.1914" y2="206.1914"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="209.1914" y2="209.1914"/><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="217" x="432.75" y="195.0156"/><line style="stroke: #000000; stroke-width: 1.0;" x1="438.75" x2="438.75" y1="207.1914" y2="207.1914"/><line style="stroke: #000000; stroke-width: 1.0;" x1="438.75" x2="438.75" y1="209.1914" y2="209.1914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="442.75" y="212.0107">choosing a replication strategy</text><line style="stroke: #000000; stroke-width: 1.0;" x1="641.75" x2="641.75" y1="207.1914" y2="207.1914"/><line style="stroke: #000000; stroke-width: 1.0;" x1="641.75" x2="641.75" y1="209.1914" y2="209.1914"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651.5" x2="693.5" y1="266.5703" y2="266.5703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="693.5" y1="266.5703" y2="279.5703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="652.5" x2="693.5" y1="279.5703" y2="279.5703"/><polygon fill="#A80036" points="662.5,275.5703,652.5,279.5703,662.5,283.5703,658.5,279.5703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="658.5" y="261.7139">Chooses the replication strategy</text><path d="M384,234.3672 L384,293.3672 L642,293.3672 L642,244.3672 L632,234.3672 L384,234.3672 " fill="#FBFB77" filter="url(#f1l6p3ja5fjcqm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M632,234.3672 L632,244.3672 L642,244.3672 L632,234.3672 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="390" y="252.8623">If the master index UUID did not changed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="390" y="269.2139">the incremental strategy is choosen,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="390" y="285.5654">if not the full copy strategy is choosen.</text><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1076.5" x="3" y="323.5977"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="323.5977" y2="323.5977"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="326.5977" y2="326.5977"/><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="299" x="391.75" y="312.4219"/><line style="stroke: #000000; stroke-width: 1.0;" x1="397.75" x2="397.75" y1="324.5977" y2="324.5977"/><line style="stroke: #000000; stroke-width: 1.0;" x1="397.75" x2="397.75" y1="326.5977" y2="326.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="277" x="401.75" y="329.417">Alternative: Incremental replication process</text><line style="stroke: #000000; stroke-width: 1.0;" x1="682.75" x2="682.75" y1="324.5977" y2="324.5977"/><line style="stroke: #000000; stroke-width: 1.0;" x1="682.75" x2="682.75" y1="326.5977" y2="326.5977"/><polygon fill="#A80036" points="402.5,364.7734,392.5,368.7734,402.5,372.7734,398.5,368.7734" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="639.5,364.7734,649.5,368.7734,639.5,372.7734,643.5,368.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="645.5" y1="368.7734" y2="368.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="408.5" y="364.2686">compares local files and the given file list</text><polygon fill="#A80036" points="1006.5,395.125,1016.5,399.125,1006.5,403.125,1010.5,399.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651.5" x2="1012.5" y1="399.125" y2="399.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="658.5" y="394.6201">requests the diff files</text><polygon fill="#A80036" points="662.5,425.4766,652.5,429.4766,662.5,433.4766,658.5,429.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="656.5" x2="1017.5" y1="429.4766" y2="429.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="668.5" y="424.9717">returns the requested files</text><polygon fill="#A80036" points="265.5,455.8281,255.5,459.8281,265.5,463.8281,261.5,459.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="259.5" x2="650.5" y1="459.8281" y2="459.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="271.5" y="455.3232">stores the new files</text><polygon fill="#A80036" points="379.5,486.1797,389.5,490.1797,379.5,494.1797,383.5,490.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="254.5" x2="385.5" y1="490.1797" y2="490.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="261.5" y="485.6748">moves the new files</text><polygon fill="#A80036" points="402.5,516.5313,392.5,520.5313,402.5,524.5313,398.5,520.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="650.5" y1="520.5313" y2="520.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="408.5" y="516.0264">reloads the IndexSearcher/IndexReader</text><polygon fill="#A80036" points="402.5,546.8828,392.5,550.8828,402.5,554.8828,398.5,550.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="650.5" y1="550.8828" y2="550.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="408.5" y="546.3779">deletes the old files</text><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1076.5" x="3" y="580.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="580.4102" y2="580.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="583.4102" y2="583.4102"/><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="247" x="417.75" y="569.2344"/><line style="stroke: #000000; stroke-width: 1.0;" x1="423.75" x2="423.75" y1="581.4102" y2="581.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="423.75" x2="423.75" y1="583.4102" y2="583.4102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="225" x="427.75" y="586.2295">Alternative: Full replication process</text><line style="stroke: #000000; stroke-width: 1.0;" x1="656.75" x2="656.75" y1="581.4102" y2="581.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="656.75" x2="656.75" y1="583.4102" y2="583.4102"/><polygon fill="#A80036" points="1006.5,621.5859,1016.5,625.5859,1006.5,629.5859,1010.5,625.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651.5" x2="1012.5" y1="625.5859" y2="625.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="658.5" y="621.0811">requests every index files</text><polygon fill="#A80036" points="662.5,651.9375,652.5,655.9375,662.5,659.9375,658.5,655.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="656.5" x2="1017.5" y1="655.9375" y2="655.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="668.5" y="651.4326">returns the requested files</text><polygon fill="#A80036" points="265.5,682.2891,255.5,686.2891,265.5,690.2891,261.5,686.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="259.5" x2="650.5" y1="686.2891" y2="686.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="271.5" y="681.7842">stores the new files</text><polygon fill="#A80036" points="104,712.6406,94,716.6406,104,720.6406,100,716.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="390.5" y1="716.6406" y2="716.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="110" y="712.1357">moves the old files</text><polygon fill="#A80036" points="379.5,742.9922,389.5,746.9922,379.5,750.9922,383.5,746.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="254.5" x2="385.5" y1="746.9922" y2="746.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="261.5" y="742.4873">moves the new files</text><polygon fill="#A80036" points="402.5,773.3438,392.5,777.3438,402.5,781.3438,398.5,777.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="650.5" y1="777.3438" y2="777.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="408.5" y="772.8389">reloads the IndexSearcher/IndexReader</text><polygon fill="#A80036" points="104,803.6953,94,807.6953,104,811.6953,100,807.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="650.5" y1="807.6953" y2="807.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="110" y="803.1904">deletes the old files</text><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1076.5" x="3" y="837.2227"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="837.2227" y2="837.2227"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1079.5" y1="840.2227" y2="840.2227"/><rect fill="#EEEEEE" filter="url(#f1l6p3ja5fjcqm)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="214" x="434.25" y="826.0469"/><line style="stroke: #000000; stroke-width: 1.0;" x1="440.25" x2="440.25" y1="838.2227" y2="838.2227"/><line style="stroke: #000000; stroke-width: 1.0;" x1="440.25" x2="440.25" y1="840.2227" y2="840.2227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="192" x="444.25" y="843.042">ending the replication process</text><line style="stroke: #000000; stroke-width: 1.0;" x1="640.25" x2="640.25" y1="838.2227" y2="838.2227"/><line style="stroke: #000000; stroke-width: 1.0;" x1="640.25" x2="640.25" y1="840.2227" y2="840.2227"/><polygon fill="#A80036" points="882.5,878.3984,892.5,882.3984,882.5,886.3984,886.5,882.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651.5" x2="888.5" y1="882.3984" y2="882.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="658.5" y="877.8936">release replication session</text><polygon fill="#A80036" points="1006.5,908.75,1016.5,912.75,1006.5,916.75,1010.5,912.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="894.5" x2="1012.5" y1="912.75" y2="912.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="901.5" y="908.2451">release snapshot</text><!--
@startuml
participant SlaveReplWorkTrashDir
participant SlaveReplWorkDir
participant SlaveIndexDir
participant Slave
participant Master
participant MasterIndexDir

==== starting the replication process ====
Slave->Master : replication session request
Master<->MasterIndexDir : takes a snapshot
Master->Slave : returns the file list and the index UUID

==== choosing a replication strategy ====
Slave->Slave : Chooses the replication strategy
note left
  If the master index UUID did not changed
  the incremental strategy is choosen,
  if not the full copy strategy is choosen.
end note

==== Alternative: Incremental replication process ====
Slave<->SlaveIndexDir : compares local files and the given file list
Slave->MasterIndexDir : requests the diff files
MasterIndexDir->Slave : returns the requested files
Slave->SlaveReplWorkDir : stores the new files
SlaveReplWorkDir->SlaveIndexDir : moves the new files
Slave->SlaveIndexDir : reloads the IndexSearcher/IndexReader
Slave->SlaveIndexDir : deletes the old files

==== Alternative: Full replication process ====
Slave->MasterIndexDir : requests every index files
MasterIndexDir->Slave : returns the requested files
Slave->SlaveReplWorkDir : stores the new files
SlaveIndexDir->SlaveReplWorkTrashDir : moves the old files
SlaveReplWorkDir->SlaveIndexDir : moves the new files
Slave->SlaveIndexDir : reloads the IndexSearcher/IndexReader
Slave->SlaveReplWorkTrashDir : deletes the old files

==== ending the replication process ====
Slave->Master : release replication session
Master->MasterIndexDir : release snapshot
@enduml

PlantUML version 1.2018.01(Sun Jan 28 19:08:22 CET 2018)
(APACHE source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_161-b12
Operating System: Windows 7
OS Version: 6.1
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>